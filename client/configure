#!/bin/bash
set -u
set -e

# Run this script to configure the appliation for the current platform.
# The bash version is for Ubuntu/Debian, CentOS/RHEL, and Mac OSX.

config="config.h"

echo '// This file is automatically generated by the configure script.' > ${config}
echo '// Any changes made here will be overwritten next time the script is run.' >> ${config}

echo '#ifndef _FOREST_CONFIG_H' >> ${config}
echo '#define _FOREST_CONFIG_H' >> ${config}
echo '#define CONFIG_FILE_PATH "/etc/forest-client.conf"' >> ${config}
echo '#define DEFAULT_SERVER_URL "http://forest/forest"' >> ${config}

# Detect what OS we're on and set reasonable config options.
if which apt-get; then
	# Ubuntu/Debian use apt-get
	echo "#define PACKAGE_MANAGER AptCli" >> ${config}
	echo "#define REBOOT_MANAGER FilePresence" >> ${config}
elif which yum; then
	# RHEL, CentOS, Fedora, etc. use yum
	echo "#define PACKAGE_MANAGER Yum" >> ${config}
	echo "#define REBOOT_MANAGER KernelDifference" >> ${config}
elif [ `uname -s` = "Darwin" ] ; then
	# MacOS
	echo "#define PACKAGE_MANAGER MacSU" >> ${config}
	# no reboot manager yet
	echo "#define REBOOT_MANAGER RebootStub" >> ${config}
else
	echo "Unable to detect OS, please generate config.h manually!"
fi

echo "#endif" >> ${config}

