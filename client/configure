#!/bin/bash
set -u

config="config.h"

echo '#ifndef _FOREST_CONFIG_H' > ${config}
echo '#define _FOREST_CONFIG_H' >> ${config}
echo '#define CONFIG_FILE_PATH "/etc/forest-client.conf"' >> ${config}
echo '#define DEFAULT_SERVER_URL "http://forest/forest"' >> ${config}

# detect what OS we're on and set reasonable config options
# need to find something better for Ubuntu, LSB is present on many OSes
if [ -f /etc/lsb-release ] ; then
	# Ubuntu uses apt-get
	echo "#define PACKAGE_MANAGER AptGet" >> ${config}
	echo "#define REBOOT_MANAGER FilePresence" >> ${config}
elif [ -f /etc/redhat-release ] ; then
	# RHEL, CentOS, Fedora, etc. use yum
	echo "#define PACKAGE_MANAGER Yum" >> ${config}
	echo "#define REBOOT_MANAGER KernelDifference" >> ${config}
elif [ `uname -s` = "Darwin" ] ; then
	# MacOS
	echo "#define PACKAGE_MANAGER MacSU" >> ${config}
	# no reboot manager yet
	echo "#define REBOOT_MANAGER RebootStub" >> ${config}
fi

echo "#endif" >> ${config}
